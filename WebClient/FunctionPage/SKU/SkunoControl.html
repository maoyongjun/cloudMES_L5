<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
    <meta http-equiv="expires" content="0">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title set-lan="html:Title">Skuno Control</title>
    <link href="../../css/plugins/jQueryUI/jquery-ui.min.css" rel="stylesheet" />
    <link href="../../css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="../../css/font-awesome.css?v=4.4.0" rel="stylesheet">
    <link href="../../css/animate.css" rel="stylesheet">
    <link href="../../css/style.css?v=4.1.0" rel="stylesheet">
    <link href="../../css/plugins/sweetalert/sweetalert.css" rel="stylesheet" />
    <link href="../../css/plugins/bootstrapTable/bootstrap-table.min.css" rel="stylesheet" />
    <link href="../../css/bu_manager.css" rel="stylesheet" />
</head>
<body class="gray-bg">
    <div class="wrapper wrapper-content  animated fadeInRight">
        <div class="row">
            <div class="col-sm-12">
                <div class="ibox">
                    <div class="panel-heading bg-primary">
                        <h3><i class="glyphicon glyphicon-tags"></i><span style="padding-left:10px;" set-lan="html:SKUSetting">Sku Setting</span></h3>
                    </div>
                    <div class="ibox-content">
                        <div id="SkunoList" class="row row-lg form-horizontal">
                            <div class="col-sm-12">
                                <div class="ibox float-e-margins no-margins">
                                    <div class="ibox-content" style="padding-bottom:0px;">
                                            <div class="form-group row">
                                                <label class="col-sm-2 control-label text-right" set-lan="html:txtSkuno">Skuno:</label>
                                                <div class="col-sm-4">
                                                    <input type="text" id="txtSkuno" class="form-control"  set-lan="attr:placeholder=placeholderSkuno" placeholder="請輸入需要查詢的機種"/>
                                                </div>
                                                <div class="col-sm-4">
                                                    <button type="button" class="btn btn-primary" onclick="SearchSkuno()"><i class="fa fa-search"></i> <lan set-lan="html:select">查詢</lan></button>
                                                </div>
                                            </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-12">
                                <div class="example-wrap">
                                    <h3 set-lan="html:ViewSkunoList">機種清單</h3>
                                    <div class="ibox-content">
                                        <div class="example">
                                            <div class="bootstrap-table">
                                                <div class="fixed-table-toolbar">
                                                    <div class="bs-bars pull-left">
                                                        <div class="btn-group " id="exampleTableEventsToolbar" role="group">
                                                            <button type="button" class="btn btn-outline btn-default" onclick="    SkunoAdd()">
                                                                <i class="glyphicon glyphicon-plus" aria-hidden="true"></i><lan set-lan="html:add">Add</lan>
                                                            </button>
                                                            <button type="button" class="btn btn-outline btn-default" name="btnEdit" onclick="    SkunoModify()">
                                                                <i class="glyphicon glyphicon-wrench" aria-hidden="true"></i><lan set-lan="html:edit">Edit</lan>
                                                            </button>
                                                            <button type="button" class="btn btn-outline btn-default" onclick="    SkunoDel()">
                                                                <i class="glyphicon glyphicon-trash" aria-hidden="true"></i><lan set-lan="html:delete">Delete</lan>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <table id="tb_departments" class="table table-hover"></table>
                                            </div><div class="clearfix"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="ModifyList" class="clients-list">
                            <!--tabs標題-->
                            <div class="col-sm-12 tab-content row" style="margin-bottom: 10px;margin-top: -10px;">
                                <button type="button" class="btn btn-primary" onclick="    BackSkuno()"><i class="fa fa-step-backward"></i> <lan set-lan="html:back">返回</lan></button>
                            </div>
                            <ul class="nav nav-tabs" id="myTab">
                                <li class="active">
                                    <a data-toggle="tab" href="#ModifySkuno"><i class="fa fa-list"></i> <lan set-lan="html:SkunoMsg">機種信息</lan></a>
                                </li>
                                <li class="">
                                    <a data-toggle="tab" href="#EditThrowPoint"><i class="fa fa-th-list"></i> <lan set-lan="html:ThrowPoint">拋帳點</lan></a>
                                </li>
                                <li class="">
                                    <a data-toggle="tab" href="#RouteList"><i class="fa fa-th-list"></i> <lan set-lan="html:RouteList">綁定路由</lan></a>
                                </li>
                                <li class="">
                                    <a data-toggle="tab" href="#LabelList"><i class="fa fa-th-list"></i> <lan set-lan="html:LabelList">Label配置</lan></a>
                                </li>
                            </ul>
                            <div class="tab-content">
                                <div id="ModifySkuno" class="tab-pane active row row-lg">
                                    <div class="ibox float-e-margins">
                                        <div class="ibox-title">
                                            <h5 set-lan="html:EditModelMsg">機種信息修改</h5>
                                        </div>
                                        <div id="EditModelDetail" class="row form-horizontal ibox-content profile-content">
                                            <form role="form" class="form-horizontal m-t">
                                                <div class="col-sm-5">
                                                    <div class="form-group draggable" style="display:none">
                                                        <label id="la1" class="col-sm-4 control-label" set-lan="html:ModifyModelMsgID">ID：</label>
                                                        <div class="col-sm-8">
                                                            <input type="text" class="form-control" name="SkuId" />
                                                        </div>
                                                    </div>
                                                    <div class="form-group draggable">
                                                        <label class="col-sm-4 control-label" set-lan="html:ModifyModelMsgSKUNO">SKUNO：</label>
                                                        <div class="col-sm-8">
                                                            <input type="text" class="form-control" name="SkuNo" id="SKUNO" onchange="AddSku()" set-lan="attr:placeholder=ModifyTxtSKUNO" />
                                                        </div>
                                                    </div>
                                                    <div class="form-group draggable">
                                                        <label class="col-sm-4 control-label" set-lan="html:ModifyModelMsgBU">BU：</label>
                                                        <div class="col-sm-8">
                                                            <input type="text" class="form-control" name="Bu" set-lan="attr:placeholder=ModifyTxtBU" readonly/>
                                                        </div>
                                                    </div>

                                                    <div class="form-group draggable">
                                                        <label class="col-sm-4 control-label" set-lan="html:ModifyModelMsgVERSION">VERSION：</label>
                                                        <div class="col-sm-8">
                                                            <input type="text" class="form-control" name="Version" set-lan="attr:placeholder=ModifyTxtVERSION"/>
                                                        </div>
                                                    </div>
                                                    <div class="form-group draggable">
                                                        <label class="col-sm-4 control-label" set-lan="html:ModifyModelMsgCODENAME">CODENAME：</label>
                                                        <div class="col-sm-8">
                                                            <input type="text" class="form-control" name="CodeName"  set-lan="attr:placeholder=ModifyTxtCODENAME" />
                                                        </div>
                                                    </div>
                                                    <div class="form-group draggable">
                                                        <label class="col-sm-4 control-label" set-lan="html:ModifyModelSkuType">SKU TYPE：</label>
                                                        <div class="col-sm-8">
                                                            <select class="form-control" name="SkuType">
                                                                <option value="MODEL">MODEL</option>
                                                                <option value="PCBA">PCBA</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-group draggable">
                                                        <label class="col-sm-4 control-label" set-lan="html:ModifyModelMsgDESCRIPTION">DESCRIPTION：</label>
                                                        <div class="col-sm-8">
                                                            <input type="text" class="form-control" name="Description"  set-lan="attr:placeholder=ModifyTxtDESCRIPTION" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-5">
                                                    <div class="form-group draggable">
                                                        <label class="col-sm-4 control-label" set-lan="html:ModifyModelMsgCSERIESID">CSERIESID：</label>
                                                        <div class="col-sm-8" name="divSeries">
                                                            <input type="text" class="form-control" name="SeriesId"  set-lan="attr:placeholder=ModifyModelMsgCSERIESID" />
                                                        </div>
                                                    </div>

                                                    <div class="form-group draggable">
                                                        <label class="col-sm-4 control-label" set-lan="html:ModifyModelMsgCUSTPARTNO">CUSTPARTNO：</label>
                                                        <div class="col-sm-8">
                                                            <input type="text" class="form-control" name="CustPartNo" set-lan="attr:placeholder=ModifyTxtCUSTPARTNO" />
                                                        </div>
                                                    </div>
                                                    <div class="form-group draggable">
                                                        <label class="col-sm-4 control-label" set-lan="html:ModifyModelMsgCUSTSKUCODE">CUSTSKUCODE：</label>
                                                        <div class="col-sm-8">
                                                            <input type="text" class="form-control" name="CustSkuCode" set-lan="attr:placeholder=ModifyTxtCUSTSKUCODE"  />
                                                        </div>
                                                    </div>
                                                    <div class="form-group draggable">
                                                        <label class="col-sm-4 control-label" set-lan="html:ModifyModelMsgSNRULE">SNRULE：</label>
                                                        <div class="col-sm-8">
                                                            <input type="text" class="form-control" name="SnRule" set-lan="attr:placeholder=ModifyTxtSNRULE" />
                                                        </div>
                                                    </div>
                                                    <div class="form-group draggable">
                                                        <label class="col-sm-4 control-label" set-lan="html:ModifyModelMsgPANELRULE">PANEL RULE：</label>
                                                        <div class="col-sm-8">
                                                            <input type="text" class="form-control" name="PanelRule" set-lan="attr:placeholder=ModifyTxtPANELRULE" />
                                                        </div>
                                                    </div>
                                                    <div class="form-group draggable" style="display:none">
                                                        <label class="col-sm-4 control-label" set-lan="html:ModifyModelMsgLASTEDITTIME">LAST_EDIT_TIME：</label>
                                                        <div class="col-sm-8">
                                                            <input type="text" class="form-control" name="LastEditTime" set-lan="attr:placeholder=ModifyModelMsgLASTEDITTIME" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-2"></div>
                                            <div class="hr-line-dashed col-sm-12"></div>
                                            <div class="form-group draggable">
                                                <div class="col-sm-12 col-sm-offset-4">
                                                    <button type="button" class="btn btn-primary" onclick="goToEdit()"><i class="fa fa-pencil"></i> <lan set-lan="html:BtnSave">保存信息</lan></button>
                                                </div>
                                            </div>
                                            </form>
                                        </div>
                                    </div>  
                                </div>
                                <div id="EditThrowPoint" class="tab-pane row row-lg">
                                    <div class="col-sm-12">
                                        <div class="ibox float-e-margins no-margins">
                                            <div class="ibox-title">
                                                <h5 set-lan="html:SAP_STATION_CODE">拋帳點</h5>
                                            </div>
                                            <div class="ibox-content" style="padding-bottom:0px;">
                                                <form role="form" class="form-horizontal">
                                                    <div class="form-group row">
                                                        <label class="col-sm-2 control-label" set-lan="html:txtSkuno">SKUNO:</label>
                                                        <div class="col-sm-2">
                                                            <input type="text" id="SKUNONs" class="form-control" name="SKUNO" readonly>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-12">
                                        <div class="example-wrap">
                                            <h3 set-lan="html:ViewThrowPointList">帳點信息</h3>
                                            <div class="ibox-content">
                                                <div class="example">
                                                    <div class="bootstrap-table">
                                                        <div class="fixed-table-toolbar">
                                                            <div class="bs-bars pull-left">
                                                                <div class="btn-group " id="exampleTableEventsToolbar" role="group">
                                                                    <button type="button" class="btn btn-outline btn-default" onclick="    ThrowPointAdd()">
                                                                        <i class="glyphicon glyphicon-plus" aria-hidden="true"></i><lan set-lan="html:add">Add</lan>
                                                                    </button>
                                                                    <button type="button" class="btn btn-outline btn-default" onclick="    ThrowPointEdit()">
                                                                        <i class="glyphicon glyphicon-wrench" aria-hidden="true"></i><lan set-lan="html:edit">Edit</lan>
                                                                    </button>
                                                                    <button type="button" class="btn btn-outline btn-default" onclick="    ThrowPointDelete()">
                                                                        <i class="glyphicon glyphicon-trash" aria-hidden="true"></i><lan set-lan="html:delete">Delete</lan>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <table id="tb_ThrowPoint" class="table table-hover"></table>
                                                    </div><div class="clearfix"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="RouteList" class="tab-pane row row-lg">
                                    <div class="ibox-title">
                                        <h3 ><lan set-lan="text:AddRoute">綁定路由</lan></h3>
                                    </div>
                                    <div class="ibox-content">
                                        <div role="form" class="form-horizontal">
                                            <div class="col-sm-3">
                                                <!--<select id="SKUAddRouteName" class="form-control m-b"></select>-->
                                                <input type="text" class="form-control" id="SKUAddRouteName" />
                                            </div>
                                            <input type="checkbox" id="checkbox-id" value=""><label set-lan="html:DefaultRoute">是否默認路由</label>
                                            <button class="btn btn-primary" id="SKU_Route" onclick="AddSKURoute()"><i class="fa"><lan set-lan="text:add">新增</lan></i></button>
                                        </div>
                                    </div>
                                    <div class="ibox-title">
                                        <h3><lan set-lan="text:RouteView">路由列表</lan></h3>
                                    </div>
                                    <div class="fixed-table-toolbar">
                                        <div class="bs-bars pull-left">
                                            <div class="btn-group " id="exampleTableEventsToolbar" role="group">
                                                <!--<button type="button" class="btn btn-outline btn-default" onclick="">
                                                    <i class="glyphicon glyphicon-wrench" aria-hidden="true"></i><lan set-lan="html:edit"> 查看路由</lan>
                                                </button>-->
                                                <button type="button" class="btn btn-outline btn-default" onclick="    DeleteRoute()">
                                                    <i class="glyphicon glyphicon-trash" aria-hidden="true" ></i><lan set-lan="html:delete"> delete</lan>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <table class="table table-hover " id="RouteListTable"></table>

                                </div>
                                <div id="LabelList" class="tab-pane row row-lg">
                                    <div class="ibox-title">
                                        <h3><lan set-lan="text:AddRoute">Label设置</lan></h3>
                                    </div>
                                    <div class="ibox-content">
                                        <div role="form" class="form-horizontal">
                                            <div class="form-group col-xs-6">
                                                <label class="col-xs-3 control-label text-right" set-lan="html:Station">打印工站:</label>
                                                <div class="col-xs-9">
                                                    <select class="form-control" id="txt_Station">
                                                        <option>xxxxx</option>
                                                        <option>33333333</option>
                                                        <option>4444444444</option>
                                                        <option>555555555</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group col-xs-6">
                                                <label class="col-xs-3 control-label text-right" set-lan="html:PrintQTY">打印數量:</label>
                                                <div class="col-xs-9">
                                                    <input class="form-control" id="txt_QTY">
                                                </div>
                                            </div>

                                            <div class="form-group col-xs-6">
                                                <label class="col-xs-3 control-label text-right" set-lan="html:LabelTemplate">标签模板:</label>
                                                <div class="col-xs-9">
                                                    <select class="form-control" id="txt_LabelTemplate">
                                                        <option>xxxxx</option>
                                                        <option>33333333</option>
                                                        <option>4444444444</option>
                                                        <option>555555555</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group col-xs-6">
                                                <label class="col-xs-3 control-label text-right" set-lan="html:LabelType">标签类型:</label>
                                                <div class="col-xs-9">
                                                    <select class="form-control" id="txt_LabelType">
                                                        <option>xxxxx</option>
                                                        <option>33333333</option>
                                                        <option>4444444444</option>
                                                        <option>555555555</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <button class="btn btn-primary" id="SKU_Route" onclick="JavaScript:void(0)"><i class="fa"><lan set-lan="text:add">新增</lan></i></button>
                                        </div>
                                    </div>
                                    <div class="ibox-title">
                                        <h3><lan set-lan="text:RouteView">Label列表</lan></h3>
                                    </div>
                                    <div class="fixed-table-toolbar">
                                        <div class="bs-bars pull-left">
                                            <div class="btn-group " id="exampleTableEventsToolbar" role="group">                                                
                                                <button type="button" class="btn btn-outline btn-default" onclick=" DeleteRoute()">
                                                    <i class="glyphicon glyphicon-trash" aria-hidden="true"></i><lan set-lan="html:delete"> 删除</lan>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <table class="table table-hover " id="LabelListTable"></table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--拋帳點修改彈出窗口-->
    <div class="modal fade" id="ModalThrowPointEdit" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="exampleModalLabel" set-lan="html:EditThrowPoint">修改</h4>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group" style="display:none">
                            <label for="recipient-name" class="control-label" set-lan="html:ModalThrowPointEditID" style="display:none">ID:</label>
                            <input type="text" class="form-control" name="ID">
                        </div>
                        <div class="form-group">
                            <label for="message-text" class="control-label" set-lan="html:SkuNo">機種:</label>
                            <input type="text" class="form-control" name="SKUNO" readonly="readonly">
                        </div>
                        <div class="form-group">
                            <label for="message-text" class="control-label" set-lan="html:STATION_NAME">工站名稱:</label>
                            <input type="text" class="form-control" name="STATION_NAME" placeholder="SMTLOADING/AOI2/AOI4 etc...">
                        </div>
                        <div class="form-group" id="divStationCode">
                            <label for="message-text" class="control-label" set-lan="html:SAP_STATION_CODE">拋賬點:</label>
                            <!--<input type="text" class="form-control" name="SAP_STATION_CODE">-->
                            <select class="form-control" name="SAP_STATION_CODE">
                                <option value="0010" selected="selected">0010</option>
                                <option value="0020">0020</option>
                                <option value="0030">0030</option>
                                <option value="0040">0040</option>
                                <option value="0050">0050</option>
                                <option value="0060">0060</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="message-text" class="control-label" set-lan="html:WORKORDER_TYPE">工單類型:</label>
                            <!--<input type="text" class="form-control" name="WORKORDER_TYPE">-->
                            <select class="form-control" name="WORKORDER_TYPE">
                                <option value="REGULAR">REGULAR</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="    SaveThrowPoint()"><i class="fa fa-save"></i><lan set-lan="html:save">保存</lan></button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal"><i class="fa fa-close"></i><lan set-lan="html:close">關閉</lan></button>
                </div>
            </div>
        </div>
    </div>
    <!-- 全局js -->
    <script src="../../Scripts/jquery.min.js?v=2.1.4"></script>
    <script src="../../Scripts/jquery.cookie.js"></script>
    <script src="../../Scripts/bootstrap.min.js?v=3.3.6"></script>
    <script src="../../Scripts/bootstrap.autocomplete.js"></script>
    <!-- 第三方插件 -->
    <script src="../../Scripts/plugins/JSON/json2.js"></script>
    <script src="../../Scripts/plugins/jquery-ui/jquery-ui.js"></script>
    <script src="../../Scripts/plugins/bootstrapTable/bootstrap-table.min.js"></script>
    <script src="../../Scripts/plugins/bootstrapTable/bootstrap-table-zh-TW.min.js"></script>
    <script src="../../Scripts/plugins/sweetalert/sweetalert.min.js"></script>
    <script src="../../Scripts/plugins/JSON/json2.js"></script>

    <script src="../../Scripts/global.js"></script>
    <script src="../../Scripts/MesClient.UI.js"></script>
    <script src="../../Scripts/MesClient.js"></script>
    <script>
        var mesUI = new MesClientUI(self.parent.client);
        var AddSKUId = "";
        var tableLocale = "";
        var lan = $.cookie($.MES.CK_LAN_NAME);
        $(document).ready(function () {
            $("#ModifyList").hide();
            $("#SkunoList").show();
            var SKUID = "";
            InitializationRoute();
            //加載全部機種清單
            self.parent.client.CallFunction("MESStation.Config.SkuConfig", "GetAllSku", {}, function (e) {
                if (e.Status == "Pass") {
                    if (lan == "CHINESE") {
                        tableLocale = "zh-CN"
                    }
                    else if (lan == "CHINESE_TW") {
                        tableLocale = "zh-TW"
                    }
                    else {
                        tableLocale = "en"
                    };
                    $('#tb_departments').bootstrapTable({

                        data: e.Data,

                        striped: true,                      //是否显示行间隔色
                        cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）

                        pagination: true,                   //是否显示分页（*）

                        sortable: false,                     //是否启用排序
                        sortOrder: "asc",                   //排序方式
                        sidePagination: "client",           //分页方式：client客户端分页，server服务端分页（*）

                        pageNumber: 1,                       //初始化加载第一页，默认第一页

                        pageSize: 5,                       //每页的记录行数（*）

                        pageList: [5, 20, 60, 100],        //可供选择的每页的行数（*）

                        search: false,                       //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
                        strictSearch: false,
                        searchOnEnterKey: false,            //回车搜索
                        showColumns: false,                  //是否显示所有的列

                        showRefresh: false,                  //是否显示刷新按钮
                        minimumCountColumns: 2,             //最少允许的列数
                        clickToSelect: true,                //是否启用点击选中行

                        //height: 500,             //高度调整
                        uniqueId: "RouteID",                     //每一行的唯一标识，一般为主键列

                        showToggle: false,                    //是否显示详细视图和列表视图的切换按钮
                        cardView: false,                    //是否显示详细视图
                        detailView: false,                   //是否显示父子表

                        //contentType: "application/x-www-form-urlencoded",//请求数据内容格式 默认是 application/json 自己根据格式自行服务端处理

                        dataType: "json",//期待返回数据类型
                        method: "post",//请求方式
                        searchAlign: "left",//查询框对齐方式

                        queryParamsType: "limit",//查询参数组织方式
                        queryParams: function getParams(params) {
                            //params obj
                            params.other = "otherInfo";
                            return params;
                        },
                        buttonsAlign: "left",//按钮对齐方式
                        toolbar: "#toolbar",//指定工具栏

                        toolbarAlign: "right",//工具栏对齐方式

                        columns: [{
                            checkbox: true
                        }, {
                            field: 'SkuId',
                            title: 'SkuId',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true,
                            visible: false
                        }, {
                            field: 'SkuNo',
                            title: '<label set-lan="html:SkuNo">SkuNo</label>',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true
                        }, {
                            field: 'Bu',
                            title: '<label set-lan="html:Bu">BU</label>',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true
                        }, {
                            field: 'Version',
                            title: '<label set-lan="html:Version">Version</label>',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true
                        }, {
                            field: 'SkuName',
                            title: '<label set-lan="html:CodeName">SkuName</label>',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true
                        },
                        {
                            field: 'SkuType',
                            title: '<label set-lan="html:SkuType">SkuType</label>',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true
                        },
                        {
                            field: "CSeriesId",
                            title: '<label set-lan="html:CSeriesId">CSeriesId</label>',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true,
                            visible: false
                        },
                        {
                            field: 'SeriesName',
                            title: '<label set-lan="html:SeriesName">SeriesName</label>',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true
                        },
                        {
                            field: 'CustPartNo',
                            title: '<label set-lan="html:CustPartNo">CustPartNo</label>',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true
                        }, {
                            field: 'CustSkuCode',
                            title: '<label set-lan="html:CustSkuCode">CustSkuCode</label>',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true
                        }, {
                            field: 'SnRule',
                            title: '<label set-lan="html:SnRule">SnRule</label>',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true
                        }, {
                            field: 'PanelRule',
                            title: '<label set-lan="html:PanelRule">PanelRule</label>',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true
                        }, {
                            field: 'Description',
                            title: '<label set-lan="html:Description">Description</label>',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true
                        }, {
                            field: 'LastEditTime',
                            title: '<label set-lan="html:tableEditTime">LastEditTime</label>',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true,
                            visible: false
                        }],
                        locale: tableLocale//中文支持,
                    });
                } else {
                    swal({
                        title: "ALERT",
                        text: e.Message,
                        type: "warning",
                        timer: 2000,
                        showConfirmButton: false
                    });
                    return;
                }
                mesUI.SetLanguage("SKUSetting");
                getSeries();
            });

            //獲取BU方法
            //$("#ModifySkuno input[name=BU]")[0].value = self.parent.client.UserInfo.BU;
            var postdata = {};
            mesUI.SetLanguage("SKUSetting");

            $("#txtSkuno").val("");
            $("#txtSkuno").select();
            $("#txtSkuno").focus();
        });

        //獲取series的select
        function getSeries() {
            var p = "{\"Field\":\"\",\"Value\":\"\"}";
            self.parent.client.CallFunction("MESStation.Config.SkuSeries", "FetchCurrentSeries", JSON.parse(p), function (e) {
                if (e.Status == "Pass") {
                    $("div[name=divSeries]")[0].innerHTML = "";
                    if (e.Data.length > 0) {
                        var param = "<select class=\"form-control\" name=\"SeriesId\">";
                        for (var a = 0; a < e.Data.length; a++) {
                            param = param + "<option value='" + e.Data[a].ID + "'>" + e.Data[a].SERIES_NAME + "</option>";
                        }
                        param = param + "</select>";
                        $("div[name=divSeries]").append(param);
                    }
                }
            });
        }

        //單個機種信息查詢
        function SearchSkuno() {
            var strSkuno = $("#txtSkuno").val();
            var param = "{\"Sku_Name\":\"" + strSkuno + "\"}";

            self.parent.client.CallFunction("MESStation.Config.SkuConfig", "GetSkuByName", JSON.parse(param), function (e) {
                if (e.Status == "Pass") {
                    if (Object.prototype.toString.call(e.Data) === '[object Object]') {
                        swal({
                            title: "ALERT",
                            text: e.Message,
                            type: "warning",
                            timer: 2000,
                            showConfirmButton: false
                        });
                        return;
                        //window.location = "SkunoControl.html";
                    } else {
                        $('#tb_departments').bootstrapTable("load", parseToJson(e.Data));
                    }
                }
            });
        }

        //點擊添加按鈕進入新建機種和拋帳點頁面
        function SkunoAdd() {
    
            getSeries();
            $("#ModifyList input[type=text]").each(function () {
                $(this)[0].value = "";
            });
            $("#ModifySkuno input[name=Bu]")[0].value = self.parent.client.UserInfo.BU;
            $('#ModifySkuno input[name=Version]')[0].value = "01";
            $('#ModifySkuno input[name=SnRule]')[0].value = "****************";
            //加載全部帳點信息
            var tableLocale = "";
            if (lan == "CHINESE") {
                tableLocale = "zh-CN"
            }
            else if (lan == "CHINESE_TW") {
                tableLocale = "zh-TW"
            }
            else {
                tableLocale = "en"
            };

            var NullJson = [];
            $('#tb_ThrowPoint').bootstrapTable({
                data: NullJson,
                striped: true,                      //是否显示行间隔色
                cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）

                pagination: true,                   //是否显示分页（*）

                sortable: false,                     //是否启用排序
                sortOrder: "asc",                   //排序方式
                sidePagination: "client",           //分页方式：client客户端分页，server服务端分页（*）

                pageNumber: 1,                       //初始化加载第一页，默认第一页

                pageSize: 5,                       //每页的记录行数（*）

                pageList: [5, 20, 60, 100],        //可供选择的每页的行数（*）

                search: false,                       //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
                strictSearch: false,
                searchOnEnterKey: false,            //回车搜索
                showColumns: false,                  //是否显示所有的列

                showRefresh: false,                  //是否显示刷新按钮
                minimumCountColumns: 2,             //最少允许的列数
                clickToSelect: true,                //是否启用点击选中行

                //height: 500,             //高度调整
                uniqueId: "RouteID",                     //每一行的唯一标识，一般为主键列

                showToggle: false,                    //是否显示详细视图和列表视图的切换按钮
                cardView: false,                    //是否显示详细视图
                detailView: false,                   //是否显示父子表

                //contentType: "application/x-www-form-urlencoded",//请求数据内容格式 默认是 application/json 自己根据格式自行服务端处理

                dataType: "json",//期待返回数据类型
                method: "post",//请求方式
                searchAlign: "left",//查询框对齐方式

                queryParamsType: "limit",//查询参数组织方式
                queryParams: function getParams(params) {
                    //params obj
                    params.other = "otherInfo";
                    return params;
                },
                buttonsAlign: "left",//按钮对齐方式
                toolbar: "#toolbar",//指定工具栏

                toolbarAlign: "right",//工具栏对齐方式

                columns: [{
                    checkbox: true
                }, {
                    field: 'ID',
                    title: 'ID',
                    rowspan: 1,
                    align: 'center',
                    valign: 'middle',
                    sortable: true,
                    visible: false
                }, {
                    field: 'SKUNO',
                    title: '<label set-lan="html:SkuNo">SkuNo</label>',
                    rowspan: 1,
                    align: 'center',
                    valign: 'middle',
                    sortable: true
                }, {
                    field: 'STATION_NAME',
                    title: '<label set-lan="html:STATION_NAME">STATION_NAME</label>',
                    rowspan: 1,
                    align: 'center',
                    valign: 'middle',
                    sortable: true
                }, {
                    field: 'SAP_STATION_CODE',
                    title: '<label set-lan="html:SAP_STATION_CODE">SAP_STATION_CODE</label>',
                    rowspan: 1,
                    align: 'center',
                    valign: 'middle',
                    sortable: true
                }, {
                    field: 'WORKORDER_TYPE',
                    title: '<label set-lan="html:WORKORDER_TYPE">WORKORDER_TYPE</label>',
                    rowspan: 1,
                    align: 'center',
                    valign: 'middle',
                    sortable: true
                }, {
                    field: 'EDIT_EMP',
                    title: '<label set-lan="html:tableEditEmp">EDIT_EMP</label>',
                    rowspan: 1,
                    align: 'center',
                    valign: 'middle',
                    sortable: true
                }, {
                    field: 'EDIT_TIME',
                    title: '<label set-lan="html:tableEditTime">EDIT_TIME</label>',
                    rowspan: 1,
                    align: 'center',
                    valign: 'middle',
                    sortable: true
                }],

                locale: tableLocale
            });

            $("#SkunoList").hide();
            $("#ModifyList").show()

            $("#ModifySkuno").addClass("active");
            $("#EditThrowPoint").removeClass("active");
            $("a[href=#ModifySkuno]")[0].parentNode.className = "active";
            $("a[href=#EditThrowPoint]")[0].parentNode.className = "";
            mesUI.SetLanguage("SKUSetting");
            self.parent.client.CallFunction("MESStation.Config.SkuConfig", "GetAllSku", {}, function (e) {
                if (e.Status == "Pass") {
                   $('#tb_departments').bootstrapTable('load',e.Data);
                }
        
            });
        }

        //到嵌套 JSON 中尋找指定 key 的值
        function FindValueByKey(key, data) {
            for (var d in data) {
                if (key.name == d) {
                    key.value = data[d];
                    break;
                }
                else if (Object.prototype.toString.call(data[d]) === '[object Object]') {
                    FindValueByKey(key, data[d]);
                }
            }
        }

        //將嵌套 JSON 平鋪成一層
        function parseToJson(data) {
            var objArr = new Array();
            var result = '[';
            var prefix = '';
            for (i = 0; i < data.length; i++) {
                result += '{';
                obj = data[i];
                for (var d in obj) {
                    if (Object.prototype.toString.call(obj[d]) === '[object Object]') {
                        if (prefix == '')
                            result = parseToJson2(d, obj[d], result);
                        else
                            result = parseToJson2(prefix + "_" + d, obj[d], result);
                    }
                    else {
                        if (prefix == '') {
                            if (obj[d] == null || obj[d] == "null")
                                result += '"' + d + '":"-",';
                            else
                                result += '"' + d + '":"' + obj[d] + '",';
                        }

                        else {
                            if (obj[d] == null || obj[d] == "null")
                                result += '"' + prefix + "_" + d + '":"-",';
                            else
                                result += '"' + prefix + "_" + d + '":"' + obj[d] + '",';
                        }
                    }

                }
                result = result.substring(0, result.lastIndexOf(","));
                result += "},";
            }
            result = result.substring(0, result.lastIndexOf(","));
            result += ']';
            var objs = JSON.parse(result)
            for (k = 0; k < objs.length; k++)
                objArr.push(objs[k]);
            return objArr;
        }

        function parseToJson2(prefix, data, result) {
            for (var d in data) {
                if (data[d] == null || data[d] == "null")
                    result += '"' + prefix + "_" + d + '":"-",';
                else
                    result += '"' + prefix + "_" + d + '":"' + data[d] + '",';
            }
            return result;
        }

        //選中機種後點擊編輯頁面，加載所選機種的信息和相關的帳點信息
        function SkunoModify() {

            var arrselections = $("#tb_departments").bootstrapTable('getSelections');
            if (arrselections.length > 1) {
                // toastr.warning('只能选择一行进行编辑');
                swal({
                    title: "ALERT",
                    text: "只能选择一行进行编辑",
                    type: "warning",
                    timer: 2000,
                    showConfirmButton: false
                });
                return;
            }
            if (arrselections.length <= 0) {
                //toastr.warning('请选择有效数据');
                swal({
                    title: "ALERT",
                    text: "请选择有效数据",
                    type: "warning",
                    timer: 2000,
                    showConfirmButton: false
                });
                return;
            } else {

            }
            $("#SkunoList").hide();
            $("#ModifyList").show();



            for (var i = 0; i < $("#ModifySkuno input[type=text]").length; i++) {
                FindValueByKey($("#ModifySkuno input[type=text]")[i], arrselections[0]);
            }

            $("#ModifySkuno select[name=SeriesId]")[0].value =
                 arrselections[0]["SeriesId"];

            var skuno = arrselections[0]["SkuNo"];
            $("#EditThrowPoint input[type=text]")[0].value = skuno;

            //根據選中的Skuno加載帳點信息
            self.parent.client.CallFunction("MESStation.Config.SAPStationMapConfig", "GetAllSapStationMapBySku", { 'SkuNo': skuno }, function (e) {
                if (e.Status == "Pass") {
                    for (var d in e.Data) {
                        if (e.Data[d]["EDIT_TIME"] != null)
                            e.Data[d]["EDIT_TIME"] = e.Data[d]["EDIT_TIME"].replace("T", " ");
                    }
                    var tableLocale = "";
                    if (lan == "CHINESE") {
                        tableLocale = "zh-CN"
                    }
                    else if (lan == "CHINESE_TW") {
                        tableLocale = "zh-TW"
                    }
                    else {
                        tableLocale = "en"
                    };
                    $('#tb_ThrowPoint').bootstrapTable({
                        data: e.Data,
                        striped: true,                      //是否显示行间隔色
                        cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）

                        pagination: true,                   //是否显示分页（*）

                        sortable: false,                     //是否启用排序
                        sortOrder: "asc",                   //排序方式
                        sidePagination: "client",           //分页方式：client客户端分页，server服务端分页（*）

                        pageNumber: 1,                       //初始化加载第一页，默认第一页

                        pageSize: 5,                       //每页的记录行数（*）

                        pageList: [5, 20, 60, 100],        //可供选择的每页的行数（*）

                        search: false,                       //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
                        strictSearch: false,
                        searchOnEnterKey: false,            //回车搜索
                        showColumns: false,                  //是否显示所有的列

                        showRefresh: false,                  //是否显示刷新按钮
                        minimumCountColumns: 2,             //最少允许的列数
                        clickToSelect: true,                //是否启用点击选中行

                        //height: 500,             //高度调整
                        uniqueId: "RouteID",                     //每一行的唯一标识，一般为主键列

                        showToggle: false,                    //是否显示详细视图和列表视图的切换按钮
                        cardView: false,                    //是否显示详细视图
                        detailView: false,                   //是否显示父子表

                        //contentType: "application/x-www-form-urlencoded",//请求数据内容格式 默认是 application/json 自己根据格式自行服务端处理

                        dataType: "json",//期待返回数据类型
                        method: "post",//请求方式
                        searchAlign: "left",//查询框对齐方式

                        queryParamsType: "limit",//查询参数组织方式
                        queryParams: function getParams(params) {
                            //params obj
                            params.other = "otherInfo";
                            return params;
                        },
                        buttonsAlign: "left",//按钮对齐方式
                        toolbar: "#toolbar",//指定工具栏

                        toolbarAlign: "right",//工具栏对齐方式

                        columns: [{
                            checkbox: true
                        }, {
                            field: 'ID',
                            title: 'ID',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true,
                            visible: false
                        }, {
                            field: 'SKUNO',
                            title: '<label set-lan="html:SkuNo">SkuNo</label>',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true
                        }, {
                            field: 'STATION_NAME',
                            title: '<label set-lan="html:STATION_NAME">STATION_NAME</label>',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true
                        }, {
                            field: 'SAP_STATION_CODE',
                            title: '<label set-lan="html:SAP_STATION_CODE">SAP_STATION_CODE</label>',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true
                        }, {
                            field: 'WORKORDER_TYPE',
                            title: '<label set-lan="html:WORKORDER_TYPE">WORKORDER_TYPE</label>',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true
                        }, {
                            field: 'EDIT_EMP',
                            title: '<label set-lan="html:tableEditEmp">EDIT_EMP</label>',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true
                        }, {
                            field: 'EDIT_TIME',
                            title: '<label set-lan="html:tableEditTime">EDIT_TIME</label>',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true
                        }],

                        locale: tableLocale//中文支持,
                    });
                } else {
                    swal({
                        title: "ALERT",
                        text: e.Message,
                        type: "warning",
                        timer: 2000,
                        showConfirmButton: false
                    });
                    return;
                }
                mesUI.SetLanguage("SKUSetting");
            });

            $("#ModifySkuno").addClass("active");
            $("#EditThrowPoint").removeClass("active");
            $("a[href=#ModifySkuno]")[0].parentNode.className = "active";
            $("a[href=#EditThrowPoint]")[0].parentNode.className = "";
            SKUID = arrselections[0].SkuId;
            LoadSKURoute(arrselections[0].SkuId, true);
            GetAllRouteName(arrselections[0].SkuId)
        }

        //刪除機種信息
        function SkunoDel() {
            var arrselections = $("#tb_departments").bootstrapTable('getSelections');
            //if (arrselections[0].childNodes.length == 0) {
            //    swal({
            //        title: "ALERT",
            //        text: "请选择有效数据",
            //        type: "warning",
            //        timer: 2000,
            //        showConfirmButton: false
            //    });
            //    return;
            //}
            if (arrselections.length > 1) {
                // toastr.warning('只能选择一行进行编辑');
                swal({
                    title: "ALERT",
                    text: "只能选择一行进行编辑",
                    type: "warning",
                    timer: 2000,
                    showConfirmButton: false
                });
                return;
            }
            if (arrselections.length <= 0) {
                //toastr.warning('请选择有效数据');
                swal({
                    title: "ALERT",
                    text: "请选择有效数据",
                    type: "warning",
                    timer: 2000,
                    showConfirmButton: false
                });
                return;
            }
            var param = "{\"SkuID\":\"" + arrselections[0]["SkuId"] + "\"}";
            self.parent.client.CallFunction("MESStation.Config.SkuConfig", "DeleteSkuById", JSON.parse(param), function (e) {
                if (e.Status == "Pass") {
                    swal({
                        title: "Success",
                        text: e.Message,
                        type: "success",
                        timer: 1000,
                        showConfirmButton: false
                    });
                    //刪除數據後重新加載清單
                    var strSkuno = $("#txtSkuno").val();
                    param = "{\"Sku_Name\":\"" + strSkuno + "\"}";
                    self.parent.client.CallFunction("MESStation.Config.SkuConfig", "GetSkuByName", JSON.parse(param), function (e) {
                        if (e.Status == "Pass") {
                            if (Object.prototype.toString.call(e.Data) === '[object Object]') {
                                window.location = "FunctionPage/SKU/SkunoControl.html";
                            } else {
                                $('#tb_departments').bootstrapTable("load", parseToJson(e.Data));
                            }
                        }
                    });
                } else {
                    swal({
                        title: "ALERT",
                        text: e.Message,
                        type: "warning",
                        timer: 2000,
                        showConfirmButton: false
                    });
                }
            });
        }

        //保存修改或新增的機種信息
        function goToEdit() {
            var ClassName, FunctionName, param;
            param = "{\"SkuObject\":{";
            var p = $("#EditModelDetail input[name=SkuId]").val();
            if (p == "") {//新增
                ClassName = "MESStation.Config.SkuConfig";
                FunctionName = "AddSku";
            } else {//修改
                ClassName = "MESStation.Config.SkuConfig";
                FunctionName = "UpdateSku";
                param = param + "\"SkuId\":\"" + $("#EditModelDetail input[name=SkuId]").val() + "\",";
            }
            //$("#EditModelDetail input[type=text]").each(function () {
            //    if ($(this)[0].name != "SkuId" && $(this)[0].name != "SeriesId") {
            //        param = param + "\"" + $(this)[0].name + "\":\"" + $(this).val() + "\",";
            //    } else if ($(this)[0].name == "SeriesId") {
            //        param = param + "\"SERIES\":{\"ID\":\""+$(this).val()+"\",\"" + $(this)[0].name + "\":\"" + $(this).val() + "\"},";
            //    }
            //});
            $("#EditModelDetail input[type=text]").each(function () {
                if ($(this)[0].name != "SkuId") {
                    param = param + "\"" + $(this)[0].name + "\":\"" + $(this).val() + "\",";
                }
            });
            //$("#EditModelDetail select").each(function () {
            //    if ($(this)[0].name != "SkuId" && $(this)[0].name != "SeriesId") {
            //        param = param + "\"" + $(this)[0].name + "\":\"" + $(this).val() + "\",";
            //    } else if ($(this)[0].name == "SERIES_ID") {
            //        param = param + "\"SERIES\":{\"ID\":\"" + $(this).val() + "\",\"" + $(this)[0].name + "\":\"" + $(this).val() + "\"},";
            //    }
            //});

            $("#EditModelDetail select").each(function () {
                param = param + "\"" + $(this)[0].name + "\":\"" + $(this).val() + "\",";
            });
            param = param.substring(0, param.length - 1) + "}}";

            //保存數據並清空所有input
            self.parent.client.CallFunction(ClassName, FunctionName, JSON.parse(param), function (e) {
                if (e.Status == "Pass") {
                    swal({
                        title: "Success",
                        text: e.Message,
                        type: "success",

                        timer: 1000,
                        showConfirmButton: false
                    });
                    AddSKUId = e.Data;
                    $("#EditModelDetail input[type=text]").each(function () {
                        $(this)[0].value = "";
                    });
                }
            });

            $("#EditThrowPoint input[name=SKUNO]")[0].value = $("#EditModelDetail input[name=SkuNo]").val();
            $('#myTab li:eq(1) a').tab('show');
        }

        function BackSkuno() {
            $("#ModifyList").hide()
            $("#SkunoList").show();
            location.reload(true);
            mesUI.SetLanguage("SKUSetting");
        }

        function BackModel() {
            $("#ModifyList").hide()
            $("#SkunoList").show();
        }

        function ThrowPointAdd() {
            var SkuNo = $("#EditThrowPoint input[name=SKUNO]")[0].value;
            if (SkuNo != null && SkuNo != "") {
                $("#ModalThrowPointEdit").find(".form-control").val("");
                $("#ModalThrowPointEdit input[name=SKUNO]").val(SkuNo);
                $('#ModalThrowPointEdit').modal();
            } else {
                swal({
                    title: "ALERT",
                    text: "必須先配置機種信息",
                    type: "warning",
                    timer: 2000,
                    showConfirmButton: false
                });
                return;
            }


        }

        function ThrowPointEdit() {
            var arrselections = $("#tb_ThrowPoint").bootstrapTable('getSelections');
            var SkuNo = $("#EditThrowPoint input[name=SKUNO]")[0].value;
            if (SkuNo != null && SkuNo != "") {
                if (arrselections.length > 1) {
                    // toastr.warning('只能选择一行进行编辑');
                    swal({
                        title: "ALERT",
                        text: "只能选择一行进行编辑",
                        type: "warning",
                        timer: 2000,
                        showConfirmButton: false
                    });
                    return;
                }
                if (arrselections.length <= 0) {
                    //toastr.warning('请选择有效数据');
                    swal({
                        title: "ALERT",
                        text: "请选择有效数据",
                        type: "warning",
                        timer: 2000,
                        showConfirmButton: false
                    });
                    return;
                }
                for (var colname in arrselections[0]) {
                    for (var i = 0; i < $("#ModalThrowPointEdit input[type=text]").length; i++) {
                        if (colname == $("#ModalThrowPointEdit input[type=text]")[i].name) {
                            $("#ModalThrowPointEdit input[type=text]")[i].value = arrselections[0][colname];
                        }
                    }
                }
                $("#ModalThrowPointEdit select").each(function () {
                    $(this)[0].value = arrselections[0][$(this)[0].name];
                });

                $('#ModalThrowPointEdit').modal();
            } else {
                swal({
                    title: "ALERT",
                    text: "必須先配置機種信息",
                    type: "warning",
                    timer: 2000,
                    showConfirmButton: false
                });
                return;
            }
        }

        //重新加載機種的拋賬點
        function ReloadThrowPoint() {
            //刪除數據後重新加載清單
            var SkuNo = $("#EditThrowPoint input[name=SKUNO]")[0].value;
            self.parent.client.CallFunction("MESStation.Config.SAPStationMapConfig", "GetAllSapStationMapBySku", { 'SkuNo': SkuNo }, function (e) {
                if (e.Status == "Pass") {
                    if (Object.prototype.toString.call(e.Data) === '[object Object]') {
                        //window.location = "FunctionPage/SKU/SkunoControl.html";
                        $('#tb_ThrowPoint').bootstrapTable("load", []);
                    } else {
                        for (var d in e.Data) {
                            if (e.Data[d]["EDIT_TIME"] != null)
                                e.Data[d]["EDIT_TIME"] = e.Data[d]["EDIT_TIME"].replace("T", " ");
                        }
                        $('#tb_ThrowPoint').bootstrapTable("load", e.Data);
                    }
                }
            });
        }

        function SaveThrowPoint() {
            var SkuNo = $("#EditThrowPoint input[name=SKUNO]")[0].value;
            var ClassName, FunctionName, Operation, JsonStr;
            var MapId = $("#ModalThrowPointEdit input[name=ID]").val();
            ClassName = "MESStation.Config.SAPStationMapConfig";
            FunctionName = "UpdateSapStationMap"
            if (MapId == "") {
                Operation = "ADD";
            }
            else {
                Operation = "UPDATE";
            }
            JsonStr = "{\"Operation\":\"" + Operation + "\",\"MapObject\":{";
            $("#ModalThrowPointEdit input[type=text]").each(function () {
                JsonStr += "\"" + $(this)[0].name + "\":\"" + $(this)[0].value + "\",";
            });
            $("#ModalThrowPointEdit select").each(function () {
                JsonStr += "\"" + $(this)[0].name + "\":\"" + $(this).find("option:selected").text() + "\",";
            });
            JsonStr = JsonStr.substring(0, JsonStr.length - 1) + "}}";
            $("#ModalThrowPointEdit").modal("hide");
            self.parent.client.CallFunction(ClassName, FunctionName, JSON.parse(JsonStr), function (e) {
                if (e.Status == "Pass") {
                    swal({
                        title: "Success",
                        text: e.Message,
                        type: "success",
                        timer: 1000,
                        showConfirmButton: false
                    });
                    ReloadThrowPoint();
                }
            });

        }

        function ThrowPointDelete() {
            var arrselections = $("#tb_ThrowPoint").bootstrapTable('getSelections');
            if (arrselections.length > 1) {
                swal({
                    title: "ALERT",
                    text: "只能选择一行进行编辑",
                    type: "warning",
                    timer: 2000,
                    showConfirmButton: false
                });
                return;
            }
            if (arrselections.length <= 0) {
                swal({
                    title: "ALERT",
                    text: "请选择有效数据",
                    type: "warning",
                    timer: 2000,
                    showConfirmButton: false
                });
                return;
            }
            var JsonStr = "{\"Operation\":\"DELETE\",\"MapObject\":{\"ID\":\"" + arrselections[0]["ID"] + "\"}}";
            self.parent.client.CallFunction("MESStation.Config.SAPStationMapConfig", "UpdateSapStationMap", JSON.parse(JsonStr), function (e) {
                if (e.Status == "Pass") {
                    swal({
                        title: "Success",
                        text: e.Message,
                        type: "success",
                        timer: 1000,
                        showConfirmButton: false
                    });
                    ReloadThrowPoint();
                } else {
                    swal({
                        title: "ALERT",
                        text: e.Message,
                        type: "warning",
                        timer: 2000,
                        showConfirmButton: false
                    });
                }
            });
        }

        function LoadSKURoute(SkuId, isPosBack) {
            self.parent.client.CallFunction("MESStation.Config.SkuRouteMappingConfig", "GetRoutesBySkuId", { SkuId: SkuId }, function (e) {
                if (e.Status == "Pass") {
                    var data = e.Data;
                    if (data.length == null) {
                        data = [];
                        if (isPosBack) {
                            LoadSKURouteTable(data, isPosBack);
                        }
                    } else {
                        LoadSKURouteTable(data, isPosBack);
                    }
                } else {
                    swal(e.Message, "", "warning");
                }
            })
        };

        function LoadSKURouteTable(RouteList, isPosBack) {
            if (isPosBack) {
                $('#RouteListTable').bootstrapTable('load', RouteList);
            } else {
                var c = [{ checkbox: true }];
                for (var item in RouteList[0]) {
                    c.push({ field: item, title: '<label set-lan="html:' + item + '">' + item + '</label> ' });
                }
                var tableLocale = "";
                if (lan == "CHINESE") {
                    tableLocale = "zh-CN"
                }
                else if (lan == "CHINESE_TW") {
                    tableLocale = "zh-TW"
                }
                else {
                    tableLocale = "en"
                };
                $('#RouteListTable').bootstrapTable({
                    data: RouteList,
                    striped: true,
                    cache: false,
                    pagination: true,
                    sortable: false,
                    sortOrder: "asc",
                    sidePagination: "client",
                    pageNumber: 1,
                    pageSize: 10,
                    pageList: [8, 15, 30, 70],
                    search: false,
                    strictSearch: false,
                    searchOnEnterKey: false,
                    showColumns: false,
                    showRefresh: false,
                    minimumCountColumns: 2,
                    clickToSelect: true,
                    showToggle: false,
                    cardView: false,
                    detailView: false,
                    dataType: "json",
                    method: "post",
                    searchAlign: "left",
                    buttonsAlign: "left",
                    toolbar: "#toolbar",
                    toolbarAlign: "right",
                    locale: tableLocale,
                    columns: c
                    //onpagechange: function (n, s) {
                    //    loadtable(n, s);
                    //}
                });
                mesUI.SetLanguage("SKUSetting");
                $('#RouteListTable').bootstrapTable('hideColumn', 'ID');  
                //$('#RouteListTable').bootstrapTable('hideColumn', 'ROUTE_ID');
                //$('#RouteListTable').bootstrapTable('hideColumn', 'SKU_ID');
            }
        };

        //MappingObject = @"{
        //    'DEFAULT_FLAG': 'Y',
        //    'SKU': {
        //        'ID': '111',
        //        'SKUNO': '222',
        //        'VERSION':'333'
        //    },
        //    'ROUTE': {
        //        'ID':'HWD00000000000000000000000000001X',
        //        'ROUTE_NAME':'555'
        //    }
        //}";

        function AddSKURoute() {
            var DEFAULT_FLAG = "";
            var SKUID = $("#tb_departments").bootstrapTable('getSelections');
            if (SKUID.length <= 0) {
                SKUID = AddSKUId;
            } else {
                SKUID = SKUID[0].SkuId;
            }
            var RouteID = $('#SKUAddRouteName').val();
            //var RouteID = $('#SKUAddRouteName').attr("real-value");
            if ($('#checkbox-id').is(':checked')) {
                DEFAULT_FLAG = "Y";
            } else {
                DEFAULT_FLAG = "N";
            }
            var AddSKURouteData = {
                'DEFAULT_FLAG': DEFAULT_FLAG,
                'SKU_ID': SKUID,
                'ROUTE_ID': RouteID
            };

            var AddSKURouteDataJson = JSON.stringify(AddSKURouteData).replace(/\"/g, "'");

            self.parent.client.CallFunction("MESStation.Config.SkuRouteMappingConfig", "AddSKuRouteMapping", { MappingObject: AddSKURouteDataJson }, function (e) {
                if (e.Status == "Pass") {
                    swal("添加成功！", "", "success");
                    if ($('#RouteListTable').find("tbody").length > 0) {
                        LoadSKURoute(SKUID, true);
                    } else {
                        LoadSKURoute(SKUID, false);
                    }

                    GetAllRouteName(SKUID);
                } else {
                    swal(e.Message, "", "warning");
                }
            })
        };

        function GetAllRouteName(SkuId) {
            self.parent.client.CallFunction("MESStation.Config.SkuRouteMappingConfig", "GetAvailableRoutesForSku", { SkuId: SkuId }, function (e) {
                //if (e.Status == "Pass") {
                //    $("#SKUAddRouteName").empty();
                //    for (var i in e.Data) {
                //        if (e.Data.hasOwnProperty(i)) {
                //            $("#SKUAddRouteName").append("<option value='" + e.Data[i].ID + "'>" + e.Data[i].ROUTE_NAME + "</option>");
                //            //StationNameData.push({ StationName: e.Data[i].Station_Name });
                //        }
                //    }
                //} else {
                //    swal(e.Message, "", "warning");
                //}
                try {
                    $("#SKUAddRouteName").autocomplete("destroy");
                } catch (e) {

                }
                if (e.Status == "Pass") {
                    var data = [];
                    for (var i = 0 ; i < e.Data.length; i++) {
                        data.push(e.Data[i].ROUTE_NAME);
                    }
                    //$('#SKUAddRouteName').autocomplete({
                    //    source: e.Data,
                    //    formatItem: function (item) {
                    //        return item["ROUTE_NAME"];
                    //    },
                    //    setValue: function (item) {
                    //        return { 'data-value': item["ROUTE_NAME"], 'real-value': item["ID"] };
                    //    }
                    //});

                    $("#SKUAddRouteName").autocomplete({
                        minLength: 0,
                        source: data,
                        select: function (event, ui) {
                            $(this).val(ui.item.value);
                        },
                        create: function (event, ui) {
                            $(this).bind("click", function () {
                                var active = $(this).attr("autocomplete");
                                if (active == "off") {
                                    $(this).autocomplete("search", "");
                                }
                            });
                        },
                        scroll: true,
                        scrollHeight: 180,
                        position: { my: "right top", at: "right bottom" }
                    });
                }
            });
        }

        function DeleteRoute() {
            var SkuID = $("#tb_departments").bootstrapTable('getSelections');
            var RouteID = $("#RouteListTable").bootstrapTable('getSelections');

            var DeleteSKURouteData = {
                'SKU_ID': SkuID[0].SkuId,
                'ROUTE_ID': RouteID[0].ROUTE_ID
            };
                    //for (var index in RouteID)
                    //{
                    //    if (RouteID.hasOwnProperty(index)) {
                    //        DeleteSKURouteData.push({ SKU_ID: SkuID[0].SkuId, ROUTE_ID: RouteID[index].ID });
                    //    }
                    //}
            
                    var DeleteSKURouteData = JSON.stringify(DeleteSKURouteData).replace(/\"/g, "'");
                    //DeleteSKURouteData = DeleteSKURouteData.replace(/\[/g, "")
                    //DeleteSKURouteData = DeleteSKURouteData.replace(/\]/g, "")
                    self.parent.client.CallFunction("MESStation.Config.SkuRouteMappingConfig", "DeleteSkuRouteMappingByObject", { MappingObject: DeleteSKURouteData }, function (e) {
                        if (e.Status == "Pass") {
                            swal("刪除成功！", "", "success");
                            var className = $("#RouteListTable tbody tr").length;
                            if (className <= 1) {
                        
                            }
                            LoadSKURoute(SkuID[0].SkuId, true);
                            GetAllRouteName(SkuID[0].SkuId);
                        } else {
                            swal({
                                title: "刪除失敗！",
                                text: e.Message,
                                type: "warning",
                                timer: 2000,
                                showConfirmButton: false
                            });
                        }
                    })
        };

        function InitializationRoute()
        {
            var tableLocale = "";
            if (lan == "CHINESE") {
                tableLocale = "zh-CN"
            }
            else if (lan == "CHINESE_TW") {
                tableLocale = "zh-TW"
            }
            else {
                tableLocale = "en"
            };
            $('#RouteListTable').bootstrapTable({
                data: RouteList,
                striped: true,
                cache: false,
                pagination: true,
                sortable: false,
                sortOrder: "asc",
                sidePagination: "client",
                pageNumber: 1,
                pageSize: 10,
                pageList: [8, 15, 30, 70],
                search: false,
                strictSearch: false,
                searchOnEnterKey: false,
                showColumns: false,
                showRefresh: false,
                minimumCountColumns: 2,
                clickToSelect: true,
                showToggle: false,
                cardView: false,
                detailView: false,
                dataType: "json",
                method: "post",
                searchAlign: "left",
                buttonsAlign: "left",
                toolbar: "#toolbar",
                toolbarAlign: "right",
                locale: tableLocale,
                columns: [{
                    checkbox: true
                }, {
                    field: 'ID',
                    title: 'ID',
                    rowspan: 1,
                    align: 'center',
                    valign: 'middle',
                    sortable: true,
                    visible:false
                }, {
                    field: 'ROUTE_ID',
                    title: 'ROUTE_ID',
                    rowspan: 1,
                    align: 'center',
                    valign: 'middle',
                    sortable: true,
                    visible:false
                },{
                    field: 'SKU_ID',
                    title: 'SKU_ID',
                    rowspan: 1,
                    align: 'center',
                    valign: 'middle',
                    sortable: true,
                    visible: false
                },{
                    field: 'DEFAULT_FLAG',
                    title: '<label set-lan="html:DEFAULT_FLAG">DEFAULT_FLAG</label>',
                    rowspan: 1,
                    align: 'center',
                    valign: 'middle',
                    sortable: true
                }, {
                    field: 'ROUTE_NAME',
                    title: '<label set-lan="html:ROUTE_NAME">ROUTE_NAME</label>',
                    rowspan: 1,
                    align: 'center',
                    valign: 'middle',
                    sortable: true
                }, {
                    field: 'DEFAULT_SKUNO',
                    title: '<label set-lan="html:DEFAULT_SKUNO">DEFAULT_SKUNO</label>',
                    rowspan: 1,
                    align: 'center',
                    valign: 'middle',
                    sortable: true
                }, {
                    field: 'ROUTE_TYPE',
                    title: '<label set-lan="html:ROUTE_TYPE">ROUTE_TYPE</label>',
                    rowspan: 1,
                    align: 'center',
                    valign: 'middle',
                    sortable: true
                },
                        {
                            field: "EDIT_TIME",
                            title: '<label set-lan="html:EDIT_TIME">EDIT_TIME</label>',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true,
                            visible: false
                        },
                        {
                            field: 'EDIT_EMP',
                            title: '<label set-lan="html:EDIT_EMP">EDIT_EMP</label>',
                            rowspan: 1,
                            align: 'center',
                            valign: 'middle',
                            sortable: true
                        }]
                //onpagechange: function (n, s) {
                //    loadtable(n, s);
                //}
   

            });
        }

        function AddSku() {
            GetAllRouteName($('#SKUNO').val());
        }

    </script>
</body>
</html>
